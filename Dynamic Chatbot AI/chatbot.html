<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic AI Chatbot</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
        }
        
        #root {
            height: 100vh;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-size: 24px;
            color: #4f46e5;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">Loading chatbot... If this doesn't disappear, check your internet connection.</div>
    </div>
    
    <!-- Test if Tailwind is working -->
    <script>
        console.log('HTML loaded!');
        
        // Check if Tailwind is working
        setTimeout(() => {
            const root = document.getElementById('root');
            if (root && root.innerHTML.includes('Loading')) {
                console.error('React or libraries not loading. Check internet connection.');
                root.innerHTML = `
                    <div style="padding: 40px; text-align: center; font-family: Arial;">
                        <h1 style="color: #dc2626; font-size: 32px; margin-bottom: 20px;">‚ö†Ô∏è Error Loading</h1>
                        <p style="font-size: 18px; margin-bottom: 10px;">The chatbot couldn't load. Please check:</p>
                        <ul style="text-align: left; max-width: 500px; margin: 20px auto; line-height: 2;">
                            <li>‚úì You have internet connection</li>
                            <li>‚úì JavaScript is enabled in your browser</li>
                            <li>‚úì No browser extensions are blocking scripts</li>
                            <li>‚úì Try opening in Chrome or Firefox</li>
                        </ul>
                        <p style="margin-top: 30px; color: #666;">
                            <strong>Quick Test:</strong> Open browser console (F12) and check for errors
                        </p>
                    </div>
                `;
            }
        }, 5000);
    </script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Your React Component -->
    <script type="text/babel">
        console.log('React script starting...');
        
        const { useState, useRef, useEffect } = React;

        // Simple icons as SVG (no external library needed)
        const SendIcon = () => (
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const BotIcon = () => (
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="11" width="18" height="10" rx="2"></rect>
                <circle cx="12" cy="5" r="2"></circle>
                <path d="M12 7v4"></path>
                <line x1="8" y1="16" x2="8" y2="16"></line>
                <line x1="16" y1="16" x2="16" y2="16"></line>
            </svg>
        );

        const UserIcon = () => (
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const TrashIcon = () => (
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const BarChartIcon = () => (
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="20" x2="12" y2="10"></line>
                <line x1="18" y1="20" x2="18" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="16"></line>
            </svg>
        );

        const SettingsIcon = () => (
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m8.66-13.66l-5.196 5.196M8.536 8.536L3.34 3.34m18.32 17.32l-5.196-5.196M8.536 15.464L3.34 20.66"></path>
            </svg>
        );

        const MessageIcon = () => (
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        );

        const DynamicAIChatbot = () => {
          const [messages, setMessages] = useState([]);
          const [input, setInput] = useState('');
          const [isTyping, setIsTyping] = useState(false);
          const [sessionId] = useState(() => 'session_' + Date.now());
          const [activeTab, setActiveTab] = useState('chat');
          const [analytics, setAnalytics] = useState({
            totalMessages: 0,
            avgResponseTime: 0,
            sentimentStats: { positive: 0, neutral: 0, negative: 0 },
            intentStats: {},
            conversationHistory: []
          });
          const [settings, setSettings] = useState({
            backendUrl: 'http://127.0.0.1:8000',
          });
          const messagesEndRef = useRef(null);
          const [backendStatus, setBackendStatus] = useState('checking');

          useEffect(() => {
            console.log('Component mounted!');
            checkBackendConnection();
            setMessages([{
              id: 1,
              text: "Hello! I'm your Dynamic AI Assistant. I can answer questions about AI, Machine Learning, Deep Learning, NLP, and more. How can I help you today?",
              sender: 'bot',
              timestamp: new Date(),
              sentiment: 'neutral'
            }]);
          }, []);

          const checkBackendConnection = async () => {
            try {
              const response = await fetch(`${settings.backendUrl}/health`);
              if (response.ok) {
                setBackendStatus('connected');
                console.log('‚úÖ Backend connected!');
              } else {
                setBackendStatus('error');
              }
            } catch (error) {
              setBackendStatus('error');
              console.error('‚ùå Backend error:', error);
            }
          };

          const callBackendAPI = async (userMessage) => {
            const startTime = Date.now();
            
            try {
              const response = await fetch(`${settings.backendUrl}/api/chat`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  session_id: sessionId,
                  message: userMessage
                })
              });

              if (!response.ok) throw new Error(`API error: ${response.status}`);

              const data = await response.json();
              const responseTime = Date.now() - startTime;
              
              return { 
                response: data.response,
                intent: data.intent || 'unknown',
                sentiment: data.sentiment || 'neutral',
                entities: data.entities || [],
                responseTime: responseTime
              };
            } catch (error) {
              return {
                response: `‚ö†Ô∏è Backend Error: ${error.message}\n\nMake sure:\n1. Backend is running: python free_backend.py\n2. Check http://127.0.0.1:8000/health`,
                intent: 'error',
                sentiment: 'neutral',
                entities: [],
                responseTime: Date.now() - startTime,
                isError: true
              };
            }
          };

          const handleSend = async () => {
            if (!input.trim()) return;

            const userMessage = {
              id: messages.length + 1,
              text: input,
              sender: 'user',
              timestamp: new Date()
            };

            setMessages(prev => [...prev, userMessage]);
            const userInput = input;
            setInput('');
            setIsTyping(true);

            try {
              const result = await callBackendAPI(userInput);
              
              const botMessage = {
                id: messages.length + 2,
                text: result.response,
                sender: 'bot',
                timestamp: new Date(),
                sentiment: result.sentiment,
                intent: result.intent,
                responseTime: result.responseTime,
                isError: result.isError || false
              };
              
              setMessages(prev => [...prev, botMessage]);
              
              if (!result.isError) {
                updateAnalytics(result.sentiment, result.intent, result.responseTime);
              }
              
            } catch (error) {
              console.error('Error:', error);
            } finally {
              setIsTyping(false);
            }
          };

          const updateAnalytics = (sentiment, intent, responseTime) => {
            setAnalytics(prev => {
              const newStats = { ...prev };
              newStats.totalMessages += 1;
              newStats.avgResponseTime = Math.round(
                (prev.avgResponseTime * (prev.totalMessages - 1) + responseTime) / prev.totalMessages
              );
              
              newStats.sentimentStats[sentiment] = (newStats.sentimentStats[sentiment] || 0) + 1;
              newStats.intentStats[intent] = (newStats.intentStats[intent] || 0) + 1;
              
              newStats.conversationHistory.push({
                timestamp: new Date(),
                sentiment,
                intent,
                responseTime
              });
              
              return newStats;
            });
          };

          const clearChat = () => {
            setMessages([{
              id: 1,
              text: "Chat cleared. How can I help you?",
              sender: 'bot',
              timestamp: new Date()
            }]);
            setAnalytics({
              totalMessages: 0,
              avgResponseTime: 0,
              sentimentStats: { positive: 0, neutral: 0, negative: 0 },
              intentStats: {},
              conversationHistory: []
            });
          };

          useEffect(() => {
            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          }, [messages]);

          const handleKeyPress = (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              handleSend();
            }
          };

          return (
            <div className="flex flex-col h-screen bg-white">
              {/* Header */}
              <div className="bg-white border-b-2 border-indigo-200">
                <div className="px-8 py-6 flex items-center justify-between">
                  <div className="flex items-center gap-4">
                    <div className="bg-gradient-to-br from-indigo-600 to-purple-600 p-4 rounded-2xl shadow-md">
                      <BotIcon />
                    </div>
                    <div>
                      <h1 className="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                        Dynamic AI Chatbot
                      </h1>
                      <p className="text-sm text-indigo-500 font-medium mt-1">NLP ‚Ä¢ ML ‚Ä¢ Deep Learning ‚Ä¢ ChatGPT Integration</p>
                    </div>
                  </div>
                  <div className="flex gap-3">
                    <button onClick={clearChat} className="p-3 text-purple-600 hover:bg-purple-100 rounded-xl transition-all" title="Clear Chat">
                      <TrashIcon />
                    </button>
                  </div>
                </div>

                {/* Tabs */}
                <div className="flex border-t-2 border-indigo-100">
                  <button
                    onClick={() => setActiveTab('chat')}
                    className={`flex-1 px-8 py-5 font-semibold transition-all text-base ${
                      activeTab === 'chat'
                        ? 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md'
                        : 'text-indigo-600 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50'
                    }`}
                  >
                    <div className="flex items-center justify-center gap-3">
                      <MessageIcon />
                      Chat
                    </div>
                  </button>
                  <button
                    onClick={() => setActiveTab('analytics')}
                    className={`flex-1 px-8 py-5 font-semibold transition-all text-base ${
                      activeTab === 'analytics'
                        ? 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md'
                        : 'text-indigo-600 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50'
                    }`}
                  >
                    <div className="flex items-center justify-center gap-3">
                      <BarChartIcon />
                      Analytics
                    </div>
                  </button>
                  <button
                    onClick={() => setActiveTab('settings')}
                    className={`flex-1 px-8 py-5 font-semibold transition-all text-base ${
                      activeTab === 'settings'
                        ? 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md'
                        : 'text-indigo-600 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50'
                    }`}
                  >
                    <div className="flex items-center justify-center gap-3">
                      <SettingsIcon />
                      Settings
                    </div>
                  </button>
                </div>
              </div>

              {/* Content */}
              <div className="flex-1 overflow-hidden">
                {activeTab === 'chat' && (
                  <div className="flex flex-col h-full bg-gradient-to-br from-blue-50 via-white to-purple-50">
                    <div className="flex-1 overflow-y-auto px-8 py-6">
                      <div className="max-w-4xl mx-auto space-y-5">
                        {messages.map((message) => (
                          <div
                            key={message.id}
                            className={`flex gap-4 ${message.sender === 'user' ? 'flex-row-reverse' : 'flex-row'}`}
                          >
                            <div className={`flex-shrink-0 w-12 h-12 rounded-2xl flex items-center justify-center shadow-md ${
                              message.sender === 'user'
                                ? 'bg-gradient-to-br from-indigo-600 to-purple-600 text-white'
                                : 'bg-white border-2 border-indigo-200 text-indigo-600'
                            }`}>
                              {message.sender === 'user' ? <UserIcon /> : <BotIcon />}
                            </div>
                            <div className={`flex-1 ${message.sender === 'user' ? 'flex justify-end' : ''}`}>
                              <div
                                className={`max-w-2xl p-5 rounded-2xl shadow-md ${
                                  message.sender === 'user'
                                    ? 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white'
                                    : message.isError
                                    ? 'bg-purple-100 border-2 border-purple-300 text-indigo-900'
                                    : 'bg-white border-2 border-indigo-100 text-indigo-900'
                                }`}
                              >
                                <p className="text-base leading-relaxed whitespace-pre-wrap">{message.text}</p>
                                {message.sender === 'bot' && !message.isError && message.intent && (
                                  <div className="mt-4 pt-4 border-t border-indigo-100 flex items-center gap-4 text-sm">
                                    <span className="px-3 py-1 bg-blue-50 text-indigo-700 rounded-full text-xs font-semibold border border-indigo-200">
                                      {message.intent}
                                    </span>
                                    <span className="text-indigo-500 text-xs">
                                      ‚ö° {message.responseTime}ms
                                    </span>
                                  </div>
                                )}
                                <p className={`text-xs mt-3 ${
                                  message.sender === 'user' ? 'text-indigo-100' : 'text-indigo-400'
                                }`}>
                                  {message.timestamp.toLocaleTimeString()}
                                </p>
                              </div>
                            </div>
                          </div>
                        ))}
                        {isTyping && (
                          <div className="flex gap-4">
                            <div className="flex-shrink-0 w-12 h-12 rounded-2xl flex items-center justify-center bg-white shadow-md border-2 border-indigo-200">
                              <BotIcon />
                            </div>
                            <div className="bg-white border-2 border-indigo-100 rounded-2xl p-5 shadow-md">
                              <div className="flex gap-2">
                                <div className="w-2 h-2 bg-indigo-500 rounded-full animate-bounce"></div>
                                <div className="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style={{animationDelay: '150ms'}}></div>
                                <div className="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style={{animationDelay: '300ms'}}></div>
                              </div>
                            </div>
                          </div>
                        )}
                        <div ref={messagesEndRef} />
                      </div>
                    </div>

                    <div className="border-t-2 border-indigo-100 bg-white px-8 py-6">
                      <div className="max-w-4xl mx-auto">
                        <div className="flex gap-3">
                          <input
                            type="text"
                            value={input}
                            onChange={(e) => setInput(e.target.value)}
                            onKeyPress={handleKeyPress}
                            placeholder="Type your message here..."
                            className="flex-1 px-6 py-4 border-2 border-indigo-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-base bg-blue-50 text-indigo-900 placeholder-indigo-400"
                          />
                          <button
                            onClick={handleSend}
                            disabled={!input.trim()}
                            className="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-2xl hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition-all font-semibold shadow-md"
                          >
                            <SendIcon />
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {activeTab === 'analytics' && (
                  <div className="h-full overflow-y-auto bg-gradient-to-br from-blue-50 via-white to-purple-50 p-8">
                    <div className="max-w-6xl mx-auto">
                      <h2 className="text-3xl font-bold mb-8 text-indigo-900">Analytics Dashboard</h2>
                      
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div className="bg-white rounded-2xl p-8 shadow-md border-2 border-indigo-100">
                          <p className="text-sm font-semibold text-indigo-600 uppercase">Total Messages</p>
                          <p className="text-4xl font-bold text-indigo-900 mt-2">{analytics.totalMessages}</p>
                        </div>

                        <div className="bg-white rounded-2xl p-8 shadow-md border-2 border-purple-100">
                          <p className="text-sm font-semibold text-purple-600 uppercase">Avg Response</p>
                          <p className="text-4xl font-bold text-purple-900 mt-2">{analytics.avgResponseTime}ms</p>
                        </div>

                        <div className="bg-white rounded-2xl p-8 shadow-md border-2 border-indigo-100">
                          <p className="text-sm font-semibold text-indigo-600 uppercase">Conversations</p>
                          <p className="text-4xl font-bold text-indigo-900 mt-2">{analytics.conversationHistory.length}</p>
                        </div>
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div className="bg-white rounded-2xl p-8 shadow-md border-2 border-indigo-100">
                          <h3 className="text-2xl font-bold mb-8 text-indigo-900">Sentiment Distribution</h3>
                          <div className="space-y-5">
                            {Object.entries(analytics.sentimentStats).map(([sentiment, count]) => (
                              <div key={sentiment} className="space-y-2">
                                <div className="flex justify-between items-center">
                                  <span className="text-lg capitalize font-semibold text-indigo-700">{sentiment}</span>
                                  <span className="text-xl font-bold text-indigo-900">{count}</span>
                                </div>
                                <div className="w-full bg-blue-50 rounded-full h-3 border border-indigo-100">
                                  <div
                                    className="h-3 rounded-full transition-all bg-gradient-to-r from-indigo-500 to-purple-600"
                                    style={{ width: `${analytics.totalMessages > 0 ? (count / analytics.totalMessages) * 100 : 0}%` }}
                                  ></div>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>

                        <div className="bg-white rounded-2xl p-8 shadow-md border-2 border-purple-100">
                          <h3 className="text-2xl font-bold mb-8 text-purple-900">Intent Distribution</h3>
                          <div className="space-y-4">
                            {Object.entries(analytics.intentStats)
                              .sort((a, b) => b[1] - a[1])
                              .map(([intent, count]) => (
                                <div key={intent} className="flex justify-between items-center p-5 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-indigo-100">
                                  <span className="text-lg capitalize font-semibold text-indigo-700">{intent}</span>
                                  <span className="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-5 py-2 rounded-full shadow-sm">
                                    {count}
                                  </span>
                                </div>
                              ))}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {activeTab === 'settings' && (
                  <div className="h-full overflow-y-auto bg-gradient-to-br from-blue-50 via-white to-purple-50 p-8">
                    <div className="max-w-4xl mx-auto">
                      <h2 className="text-3xl font-bold mb-8 text-indigo-900">Settings & Configuration</h2>
                      
                      <div className="bg-white rounded-2xl p-8 shadow-md border-2 border-indigo-100">
                        <div className="flex items-center justify-between mb-8">
                          <h3 className="text-2xl font-bold text-indigo-900">Backend Configuration</h3>
                          <span className={`px-4 py-2 rounded-full text-sm font-semibold ${
                            backendStatus === 'connected' 
                              ? 'bg-purple-600 text-white' 
                              : 'bg-indigo-600 text-white'
                          }`}>
                            {backendStatus === 'connected' ? '‚úì Connected' : '‚úó Disconnected'}
                          </span>
                        </div>
                        
                        <div className="space-y-5">
                          <div>
                            <label className="block text-base font-semibold text-indigo-700 mb-3">Backend URL</label>
                            <input
                              type="text"
                              value={settings.backendUrl}
                              onChange={(e) => setSettings({...settings, backendUrl: e.target.value})}
                              className="w-full px-5 py-4 border-2 border-indigo-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-base bg-blue-50 text-indigo-900"
                            />
                          </div>

                          <button
                            onClick={checkBackendConnection}
                            className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-4 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition font-semibold shadow-md text-base"
                          >
                            Test Backend Connection
                          </button>

                          <div className="bg-blue-50 border-2 border-indigo-200 rounded-xl p-6">
                            <p className="text-base font-bold text-indigo-800 mb-3">üìò Backend Setup:</p>
                            <ol className="text-sm text-indigo-700 space-y-2 ml-5 list-decimal">
                              <li>Navigate to Backend folder</li>
                              <li>Run: <code className="bg-white px-3 py-1 rounded font-mono border border-indigo-200 text-purple-700">python free_backend.py</code></li>
                              <li>Check: <a href="http://127.0.0.1:8000/health" target="_blank" rel="noreferrer" className="underline font-semibold text-indigo-700">http://127.0.0.1:8000/health</a></li>
                            </ol>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        // Render the app
        console.log('Rendering React component...');
        ReactDOM.render(<DynamicAIChatbot />, document.getElementById('root'));
        console.log('‚úÖ Chatbot loaded successfully!');
    </script>
</body>
</html>